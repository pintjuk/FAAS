FROM golang:1.9

# go stuff
RUN go get -u github.com/kardianos/govendor && \
go get -u -v github.com/codeskyblue/fswatch
RUN mkdir -p /go/src/github.com/pintjuk/faas/gateway
COPY . /go/src/github.com/pintjuk/faas/gateway
WORKDIR /go/src/github.com/pintjuk/faas/gateway


EXPOSE 8080
RUN echo "desc: Auto generated by fswatch [gatewayd] \n\
triggers: \n\
- name: '' \n\
 pattens: \n\
 - '**/*.go' \n\
 env: \n\
  DEBUG: '1' \n\
 cmd: go run cmd/gatewayd/gatewayd.go \n\
 shell: true \n\
 delay: 100ms \n\
 stop_timeout: 500ms \n\
 signal: KILL \n\
 kill_signal: '' \n\
watch_paths: \n\
- . \n\
watch_depth: 10 \n\
" >> /fsw.yml

RUN govendor fetch +m && fswatch -config /fsw.yml
WORKDIR /go/src/github.com/pintjuk/faas/gateway/cmd/gatewayd
RUN go build
RUN ls
CMD ["./gatewayd"]